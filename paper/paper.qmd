---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - Kevn Shao
thanks: "Code and data are available at: https://github.com/KevinShao1357/Toronto_Daily_Shelter_And_Overnight_Service_Modelling.git."
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
toc: true
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false
#| echo: false

# Download the relevant packages needed for downloading required data if
# necessary. If packages are already downloaded, comment out the following lines.
install.packages("opendatatoronto")
install.packages("janitor")
install.packages("dplyr")
install.packages("readr")
install.packages("gt")
install.packages("AER")
install.packages("kableExtra")

# Load the necessary packages
library(tidyverse)
library(opendatatoronto)
library(janitor)
library(dplyr)
library(readr)
library(gt)
library(AER)
library(knitr)
library(kableExtra)

# Read and save the cleaned dataset
cleaned_data2 <- read.csv(here::here("data/02-analysis_data/analysis_data.csv"))
```


# Introduction

Canada provides shelters for people in need, such as refugees, the homeless, and people experiencing transitions in living spaces, and the country is continuing to build new shelters for such residents. On April 16, 2024, the Canadian government announced a funding of over 250 million dollars over two years to address homelessness and encampment all over the country. In 2022, Canada announced a target to eliminate homelessness by 2030. Canada Mortgage and Housing Corporation also allocated a total of 420 million dollars to account for homelessness (@Shelter). This implicates that the Canadian government will continuously invest in improving current shelters and building new shelters around the country. In 2024, Canada's Minister of Immigration, Refugees, and Citizenship Marc Miller also announced that the country would accept 27,000 new refguees this year, and this trend is likely to continue in the next years (@Refugee). We can conclude that more shelters are likely to be built in Canada in the future, and the same trend is also valid for the GTA(Greater Toronto Area). 

To find a way to maximize efficiency of the investment on shelters, I want to evaluate the effect of predicting then number of beds (which reflects the necessary size of shelters need be built, expanded, or renovated) by constructing a multivariate linear regression model based on variables such as specific types of shelters and their services, as well as occupancy rates and averaged number of occupants per day. We will limit our scope of prediction to the GTA(Greater Toronto Area), since it is the largest city in Canada, and is also the scope of our chosen dataset. We also set the city of where the shelter is located to Downtown Toronto, and also set the classification of shelters based on gender and age to mixed adult, which are all the ones of their category with the highest frequency. As mentioned in the previous paragraph, we also chose our response variable to be number of beds, a choice between shelters grouped by rooms or shelters grouped by beds. The reasoning behind these choices are explained in the 'Measurement' of the data section (Section @sec-data).

The remainder of this paper is structured as follows: @sec-data details the data and measurement process of the chosen dataset; @sec-results covers the multiple linear regression model used in this paper; @sec-results provides results obtain from the derived model; and @sec-discussion includes discussions, such as implications and future steps, of our model, and how our results can in turn be furthermore improved.

# Data {#sec-data}

## Overview

The dataset "Daily Shelter & Overnight Service Occupancy & Capacity" (@Dataset) was sourced from the dataset with same name found in Open Data Toronto. The paper's in-depth analysis and prelimary data analysis are all completed using the statistical programming language R (@R).

The primary objective of this paper is to evaluate the validity of predicting the number of beds necessary for a shelter by constructing a multivariate linear regression model, as mentioned in the introduction section. The number of beds of a shelter can reflect the necessary size of a shelter, so the general investment amounts of renovating existing shelters and building new shelters can be estimated, which can maximize efficiency of Canadian government's investments in shelters.

@tbl-table1 provides a sample (the first ten rows) of the cleaned dataset.

```{r}
#| label: tbl-table1
#| fig-cap: "Sample Data of Cleaned Data of Daily Shelter and Overnight Service"
#| echo: false
#| warning: false
#| message: false

kable(cleaned_data2[1:10,]) %>%
  kable_styling(font_size = 10, position = "center", full_width = FALSE)

```

## Measurement
	
Since the aim of this paper is only to evaluate the validity of predicting the number of beds necessary for a shelter by constructing a multivariate linear regression model, we want to simplify the dataset as much simple as possible. 

We first consider the classification of shelters based on gender and age, which is divided into adult men, adult women, mixed adult, youth and family. We find that mixed adult shelters takes the majority with the most observations, so we conclude that mixed adult shelters are most representative for checking the validity of the multivariate linear regression model for predicting number of beds for a shelter, so we filter out so that only mixed adult shelters are in the cleaned dataset.

Downtown Toronto has the most shelters in all the cities (of GTA(Greater Toronto Area)) in this dataset, so we also conclude that Downtown Toronto is the most representative of all the provided cities, so we then filter out the cleaned data so it only contains shelters in Downtown Toronto.

In this dataset, the shelters are either grouped by rooms or by beds. Since our aim is to analyze the validity of maximizing efficiency of investments of shelters using a multivariate linear regression model, considering number of beds will bring more accurate results. This is because each room can vary in size, so it is not a precise measure of the demand of shelters, which is ultimately based on the number of people, while it is more accurate to assume that one bed can accommodate one person. Therefore, we then filter out the cleaned data so it only contains shelters in Downtown Toronto.

In the original dataset, each observation of shelters vary by date. However, because we are discussing about investments in shelters, which is a long-term process, and our response variable is the number of beds necessary in a shelter, we want to get an average of the number of beds to maximize the efficiency of shelter investments by the Canadian government. Therefore, we ignore the date column, and just aim to construct a multivariate linear regression model considering all days from January 1 to December 1, which is the version of the dataset we chose to use, which is updated until December 2, 2024.

Then, we determine our predictor variables, made up of three categorical variables, which are classification, program area, and service type, and two numerical variables, which are capacity and occupancy rate. The rationale here is basically just ignoring the columns which only provide basic information, and then save all the remaining categorical variables (leaving the different types of shelters variables that are prepared to be involved in the multivariate linear regression model, after fixing the city, as well as general age and gender of the shelters) and numerical variables that are logical to predict the number of beds. Finally, we rename the variables to make them easier to understand, and we get our final cleaned dataset.

## Outcome variables (And Estimand)

The outcome variable, or response variable, for this multivariate linear regression model, corresponds to the variable 'count' in the cleaned data set, which in context of the dataset, is the number of occupied beds during this day. By averaging this variable's statistics over about a year, we may get a representative value of the number of beds necessary for a shelter with the given statistics of the predictor variables. Note that the variable 'count' should be less or equal to the current capacity of the corresponding shelter. Its summary statistics are presented in the following @tbl-table2.

```{r}
#| label: tbl-table2
#| tbl-cap: "Summary Statistics of Number of Beds Occupied During a Given Day"
#| echo: false
#| warning: false
#| message: false

knitr::kable(c(mean = mean(cleaned_data2$count), standard_deviation = sd(cleaned_data2$count), maximum = max(cleaned_data2$count), minimum = min(cleaned_data2$count)), align = "c", col.names = ("Beds Occupieds in a Given Day"))
```
From the above summary statistics presented in @tbl-table2, the mean of 'count' is around 50 to 51 beds occupied in a given day of a shelter, the standard deviation is around 34, and the maximum and minimum are 150 and 1 respectively. Here, we can see that 'count' has some outliers, and also has reasonable mean and standard deviation, and so 'count' is suitable for being the response variable of our multivariable linear regression model.

Since we are trying to constructing a multivariate linear regression model, our estimand is the response variable, which is the the number of occupied beds during a day (can be understood as the demand of beds) in a location that provides daily shelter or overnight service.

## Predictor variables

As mentioned in the previous measurement section, our predictor varibles are made up of three categorical variables and two numerical variables, and are already chosen, because they are the only ones that are appropriate and logical to predict the number of occupied beds at a given day for a shelter. The following is a more specific description for each of the predictor variables.

### Service Type

'Service Type' (dis a categorical predictor variable, representing the type of the overnight service being provided. Here, because we set the city to be Downtown Toronto, as well as age and gender to Mixed Adult, so only the following types exist:

A 'Shelter' is a facility that give people experiencing homelessness a temporary living space so that they can move into new housing. Shelters operate the entire year for 7 days a week and 24 hours a day (@Dataset). 

A 'Warming Centre' prevents people from experiencing extreme weather, giving people a shelter to stay in, and only opens with operation of 7 days a week and 24 hours a day during extreme weather alerts.

A '24-Hour Respite' gives people experiencing homelessness a resting place, also providing them with "meals and service referrals." It operates 7 days a week and 24 hours a day.

A 'Top Bunk Contingency Space' is not described in the dataset, but is also another type of shelter.

The following @tbl-table3 describes the number of each service type in the cleaned data. Note that 'Respite' refers to 24-Hour Respite, and 'Cont_Space' refers to Top Bunk Contigency Space.

```{r}
#| label: tbl-table3
#| tbl-cap: "Count for each service type"
#| echo: false
#| warning: false
#| message: false

knitr::kable(c(Shelter = sum(cleaned_data2$service_type == 'Shelter'), 
               Warming_Centre = sum(cleaned_data2$service_type == 'Warming Centre'),
               Respite = sum(cleaned_data2$service_type == '24-Hour Respite Site'),
               Cont_Space = sum(cleaned_data2$service_type == 'Top Bunk Contingency Space')),
             align = "c", col.names = ("Beds Occupieds in a Given Day"))
```
The above @tbl-table3 clearly represents that the four service types have very different frequencies. Shelters take the most frequency, of around 4000 observations, while 24-Hour Respites take up of around 2000 observations, about half of that of shelters, and other two have the least frequency, each of around 400 observations.

### Classifcation

The variable 'classification' corresponds to the original dataset's variable 'PROGRAM_MODEL', and are directed to either 'Emergency' or 'Transitional'. Basically, a location classified as 'Emergency' means that any people experiencing homelessness can come in without a referral, and vice versa. 

@tbl-table4 below is a table representing the counts of each of the two classifications of all the observation in the cleaned dataset.

```{r}
#| label: tbl-table4
#| tbl-cap: "Count for each classification"
#| echo: false
#| warning: false
#| message: false

knitr::kable(c(Emergency = sum(cleaned_data2$classification == 'Emergency'),
               Transitional = sum(cleaned_data2$classification == 'Transitional')),
             align = "c", col.names = ("Counts For Each Classification"))
```
From @tbl-table4, we can see that there are much more emergency locations (around 5400) than transitional locations (around 1400). There are around three times more emergency locations than transitional locations.

### Program Area

'Program Area' (denoted as 'program_area' in the cleaned dataset) "indicates whether the program is part of the base shelter and overnight services system, or is part of a temporary response program". For this cleaned dataset with the set limitations, it includes the following types.

A 'Base Program - Refugee' is a program that serves refugees and other similar groups of people, and also operates the whole year.

A 'Winter Program' is a program based on the additional spaces under winter service plans. This may also add additional spaces to existing programs. In the dataset description, it is denoted as 'Winter Response'.

A 'Base Shelter and Overnight Services System' are regular programs that are set to operate the whole year.

A 'Temporary Refugee Response' is similar to that of a 'Base Program - Refugee', but instead "create spaces in the overnight services systems" (@Dataset).

@tbl-table5 below represents the counts of observations that have each program area. Note that 'Refugee' refers to 'Base Program - Refugee', 'Base_Shelter' refers to 'Base Shelter and Overnight Services System', and 'Temp_Refugee' refers to 'Temporary Refugee Response'

```{r}
#| label: tbl-table5
#| tbl-cap: "Count for each program area"
#| echo: false
#| warning: false
#| message: false

knitr::kable(c(Refugee = sum(cleaned_data2$program_area == 'Base Program - Refugee'),
               Base_Shelter = sum(cleaned_data2$program_area == 'Base Shelter and Overnight Services System'),
               Temp_Refugee = sum(cleaned_data2$program_area == 'Temporary Refugee Response'),
               Winter_Programs = sum(cleaned_data2$program_area == 'Winter Programs')),
             align = "c", col.names = ("Counts For Each Classification"))
```
From @tbl-table5, we observe that locations with the program area 'Base Shelter and Overnight Services System' has most observations (around 4800). Locations with the program area 'Base Program - Refugee' has 1272 observations, around one-fourth of the previous one. The remaining two locations has much less observations.

### Capacity

The 'Capacity' (denoted 'capacity' in the cleaned dataset) is the maximum capacity of a location. The following @tbl-table6 gives the mean, standard deviation, maximum, and minimum of 'Capacity'.

```{r}
#| label: tbl-table6
#| tbl-cap: "Summary Statistics of Variable Capacity"
#| echo: false
#| warning: false
#| message: false

knitr::kable(c(mean = mean(cleaned_data2$capacity), standard_deviation = sd(cleaned_data2$capacity), maximum = max(cleaned_data2$capacity), minimum = min(cleaned_data2$capacity)), align = "c", col.names = ("The Capacity of a Location"))
```
From @tbl-table6, the mean of capacity of locations is around 51 people, with an acceptable standard deviation of around 34 people. The maximum and minimum of capacity are 150 and 1 people respectively, and these statistics are all acceptable for constructing a multivariable linear regression model.

### Occupancy Rate

The occupancy rate here (denoted as 'occupancy_rate' in the cleaned dataset) is basically the occupied number of beds divided by the capacity in number of beds. The occupancy rate is measured in percentage, from 0 to 100 percent.

The following @tbl-table7 represents the summary statistics of occupancy rate.

```{r}
#| label: tbl-table7
#| tbl-cap: "Summary Statistics of Occupancy Rate"
#| echo: false
#| warning: false
#| message: false

knitr::kable(c(mean = mean(cleaned_data2$occupancy_rate), standard_deviation = sd(cleaned_data2$occupancy_rate), maximum = max(cleaned_data2$occupancy_rate), minimum = min(cleaned_data2$occupancy_rate)), align = "c", col.names = ("Occupancy Rate in a Given Day"))
```
From @tbl-table7, we can conclude that occupancy rate of locations are all pretty much near 100, with a relatively low standard deviation of 5 percentage points, so most locations are relatively full, but we can still consider it as a predictor variable, but needs careful consideration when interpreting results.

# Model

Now we start to create the multivariate linear regression model, with the set predictor and response variables.

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

first_model <-
  readRDS(file = here::here("models/first_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

modelsummary::modelsummary(
  list(
    "First model" = first_model
  ),
  statistic = "mad",
  fmt = 2
)
```




# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

Please don't use these as sub-heading labels - change them to be what your point actually is.

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

pp_check(first_model) +
  theme_classic() +
  theme(legend.position = "bottom")

posterior_vs_prior(first_model) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

plot(first_model, "trace")

plot(first_model, "rhat")
```



\newpage


# References


